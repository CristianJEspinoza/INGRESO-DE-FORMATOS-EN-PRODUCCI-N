{% extends "base.html" %}

{% block title %}Registro de Verificación de Calibración de Equipos{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Título -->
    <div class="d-flex justify-content-center mb-4">
        <h1 class="text-uppercase" style="color: #FF8C00; font-weight: bold;">Registro de Verificación de Calibración de Equipos</h1>
    </div>

    <!-- Tabla -->
    <div class="table-responsive">
        <table class="table table-hover table-bordered" id="detalleLavadoManoTable">
            <!-- Encabezado de la tabla -->
            <thead class="text-white" style="background-color: #FF8C00;">
                <tr>
                    <th class="text-center align-middle">Equipo</th>
                    <th class="text-center align-middle">Fecha de mant.</th>
                    <th class="text-center align-middle">Fecha prox. mant.</th>
                    <th class="text-center align-middle">Actividad realizada</th>
                    <th class="text-center align-middle">Observaciones</th>
                    <th class="text-center align-middle">Responsable</th>
                    <th class="text-center align-middle">Estado</th>
                </tr>
            </thead>
            <!-- Cuerpo de la tabla -->
            <tbody>
                {% for f in formato %}
                <tr>
                    <td class="text-center align-middle">{{ f.equipo }}</td>
                    <td class="text-center align-middle">{{ f.fecha_mantenimiento.strftime('%d/%m/%Y') }}</td>
                    <td class="text-center align-middle">{{ f.fecha_prox_mantenimiento.strftime('%d/%m/%Y') }}</td>
                    <td class="text-center align-middle">{{ f.actividad_realizada }}</td>
                    <td class="text-center align-middle">{{ f.observaciones }}</td>
                    <td class="text-center align-middle">{{ f.responsable }}</td>
                    <td class="text-center">{{ f.estado }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <!-- Historial para el registro de verificación de calibración de equipos -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header text-white" style="background-color: #ff0000;">
            <h5 class="text-uppercase mb-0">HISTORIAL DE Registro de Verificación de Calibración de Equipos</h5>
        </div>
        <div class="card-body">
            <!-- Filtro por área, mes y año -->
            <div class="row">
                <div class="form-group col-md-4">
                    <label for="filtrarMesLACLOSE" class="text-warning">Filtrar por mes:</label>
                    <input type="month" id="filtrarMesLACLOSE" class="form-control" onchange="filterByDate()">
                </div>
            </div>
            
            <!-- Listado agrupado por mes y año -->
            <div id="accordionFinalizados">
                {% for grupo in headers_Close %}
                <div class="card mb-3">
                    <div class="card-header d-flex justify-content-between align-items-center" id="heading{{ grupo.anio }}{{ grupo.mes }}" style="background-color: #FFD700; color: #000;">
                        <div>
                            <button class="btn btn-link text-dark font-weight-bold" data-toggle="collapse" 
                                    data-target="#collapse{{ grupo.id_header_format }}" 
                                    aria-expanded="true" 
                                    aria-controls="collapse{{ grupo.id_header_format }}"
                                    onclick="cargarHistorialPorGrupo('{{ grupo.id_header_format }}')">
                                {{ grupo.mes }} del {{ grupo.anio }}
                            </button>
                        </div>
                        <div>
                            <a href="{{ url_for('verificacion_calibracion_equipos.download_formato', formato_id=grupo.id_header_format) }}" class="btn btn-info btn-sm mr-2">
                                <i class="fas fa-file-download"></i> Descargar Formato
                            </a>
                        </div>
                    </div>
                    <div id="collapse{{ grupo.id_header_format }}" class="collapse" aria-labelledby="heading{{ grupo.id_header_format }}" data-parent="#accordionFinalizados">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover table-bordered">
                                    <thead class="text-white text-center" style="background-color: #ff0000;">
                                        <tr>
                                            <th>Equipo</th>
                                            <th>Fecha de mant.</th>
                                            <th>Fecha prox. mant.</th>
                                            <th>Actividad realizada</th>
                                            <th>Observaciones</th>
                                            <th>Responsable</th>
                                            <th>Estado</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbody-historial-{{ grupo.id_header_format }}">
                                        <!-- Datos dinámicos aquí -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Paginador -->
            <div class="pagination-container mt-4 d-flex justify-content-center">
                <ul class="pagination">
                    <!-- Botón de página anterior -->
                    {% if page > 1 %}
                        <li class="page-item">
                            <a href="{{ url_for('verificacion_calibracion_equipos.index', page=page - 1) }}" class="page-link">Anterior</a>
                        </li>
                    {% endif %}
            
                    <!-- Páginas iniciales -->
                    {% if total_pages > 7 %}
                        {% for p in range(1, min(4, total_pages + 1)) %}
                            <li class="page-item {% if p == page %}active{% endif %}">
                                <a href="{{ url_for('verificacion_calibracion_equipos.index', page=p) }}" class="page-link">{{ p }}</a>
                            </li>
                        {% endfor %}
                        
                        {% if page > 4 %}
                            <li class="page-item disabled"><span class="page-link">...</span></li>
                        {% endif %}
                        
                        <!-- Páginas alrededor de la página actual -->
                        {% for p in range(max(1, page - 2), min(page + 3, total_pages + 1)) %}
                            {% if p > 3 and p < total_pages - 2 %}
                                <li class="page-item {% if p == page %}active{% endif %}">
                                    <a href="{{ url_for('verificacion_calibracion_equipos.index', page=p) }}" class="page-link">{{ p }}</a>
                                </li>
                            {% endif %}
                        {% endfor %}
            
                        {% if page < total_pages - 3 %}
                            <li class="page-item disabled"><span class="page-link">...</span></li>
                        {% endif %}
                        
                        <!-- Páginas finales -->
                        {% for p in range(max(total_pages - 2, 4), total_pages + 1) %}
                            <li class="page-item {% if p == page %}active{% endif %}">
                                <a href="{{ url_for('verificacion_calibracion_equipos.index', page=p) }}" class="page-link">{{ p }}</a>
                            </li>
                        {% endfor %}
                    {% else %}
                        <!-- Si hay menos de 7 páginas, mostrar todas las páginas -->
                        {% for p in range(1, total_pages + 1) %}
                            <li class="page-item {% if p == page %}active{% endif %}">
                                <a href="{{ url_for('verificacion_calibracion_equipos.index', page=p) }}" class="page-link">{{ p }}</a>
                            </li>
                        {% endfor %}
                    {% endif %}
            
                    <!-- Botón de página siguiente -->
                    {% if page < total_pages %}
                        <li class="page-item">
                            <a href="{{ url_for('verificacion_calibracion_equipos.index', page=page + 1) }}" class="page-link">Siguiente</a>
                        </li>
                    {% endif %}
                </ul>
            </div>                
        </div>
    </div>
</div>
<script src="{{ url_for('static', filename='js/registro_verificacion_equipos.js') }}"></script>
{% endblock %}
